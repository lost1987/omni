function _showDialog(b){$("input.pin_box").each(function(c){$(this).val("");$(this).next().text("")});showDialog(b,true);if($("#avatar_dialog tr")){var a=$("#avatar_dialog tr").eq(0);a.find("td").each(function(){$(this).find("img").click(function(){a.find("img").removeClass("on");$(this).addClass("on")})})}}function tab(b,a){if(!/(.*)?_on/.test(b)){$(a).parent().find("b").each(function(){var c=this.className.replace(/_on/g,"");$(this).removeClass(this.className);$(this).addClass(c);$("."+c+"_table").hide()});$(a).removeClass(b);$(a).addClass(b+"_on");$("."+b+"_table").show()}}function changeEmail(){var b=$("input[name='email']");var a=b.val();if(!$.is_email(a)){$(b).next().text("请填写正确的邮件地址");return}$.post("/userinfo/updateEmail","email="+a+"&csrf_token="+token,function(c){var c=$.jsonDecode(c);switch(c.error){case 0:$("#show_email").text(a);closeDialog("note");break;case 5:$(b).next().text("邮件格式错误");break;case 9:$(b).next().text("邮件地址已被注册");break;case 1:$(b).next().text("登录信息过期");break;case 3:$(b).next().text("网络错误");break}})}function changeAvatar(){var a=$("#avatar_dialog").find("tr").find("img.on").attr("id");$.post("/userinfo/updateAvatar","avatar="+a+"&csrf_token="+token,function(c){var c=$.jsonDecode(c);switch(c.error){case 0:var d=$(".user_pic").attr("src");var b=/(.*)?male\d+\.(.*)/g;a++;d=d.replace(b,"$1male"+a+".$2");$(".user_pic").attr("src",d);closeDialog("note");break;case 1:$(node).next().text("登录信息过期");break;case 3:$(node).next().text("网络错误");break}})}function changeArea(){var a=$("select[name='area']").val();$.post("/userinfo/updateArea","area="+a+"&csrf_token="+token,function(b){var b=$.jsonDecode(b);switch(b.error){case 0:$("#show_area").text($("select[name='area']").find("option").eq(a).text());closeDialog("note");break;case 1:console.log("登录信息过期");break;case 3:console.log("网络错误");break}})}function changeMobile(){var b=$("input[name='mobile']");var a=b.val();if(!$.is_mobile(a)){$(b).next().text("请填写正确的手机号码");return}$.post("/userinfo/updateMobile","mobile="+a+"&csrf_token="+token,function(c){var c=$.jsonDecode(c);switch(c.error){case 0:$("#show_mobile").html('<span style="display:inline-block">'+$.entry_phone(a)+'</span><a href="javascript:_showDialog(\'mobile_dialog\')" class="edit_note">修改手机号</a>');$("#mygold").val($("#mygold").val()+c.coins);closeDialog("note");break;case 5:$(b).next().text("手机格式错误");break;case 1:$(b).next().text("登录信息过期");break;case 3:$(b).next().text("网络错误");break}})}function changePassword(){var a=$("input[name='old_pass']");var d=$("input[name='new_pass']");var b=$("input[name='new_pass1']");var c=a.val();var f=d.val();var e=b.val();if(!$.max_length(c,16)||!$.min_length(c,6)||!$.isValidPassword(c)){a.next().text("密码为6-16位");return}if(!$.max_length(f,16)||!$.min_length(f,6)||!$.isValidPassword(f)){d.next().text("密码为6-16位");return}if(!$.max_length(e,16)||!$.min_length(e,6)||!$.isValidPassword(e)){b.next().text("密码为6-16位");return}if(f!=e){b.next().text("两次输入的新密码不一致");return}$.post("/userinfo/updatePassword","old_pass="+md5(c)+"&new_pass="+md5(f)+"&csrf_token="+token,function(g){var g=$.jsonDecode(g);switch(g.error){case 0:closeDialog("note");break;case 6:$(a).next().text("旧密码错误");break;case 1:$(b).next().text("登录信息过期");break;case 3:$(b).next().text("网络错误");break}})}function changePurcharse(){var d=$("input[name='p_new']");var b=$("input[name='p_new1']");var f=d.val();var e=b.val();if(is_set_purchase==1){var a=$("input[name='p_old']");var c=a.val();if(!$.max_length(c,16)||!$.min_length(c,6)||!$.isValidPassword(c)){a.next().text("密码为6-16位");return}if(!$.max_length(f,16)||!$.min_length(f,6)||!$.isValidPassword(f)){d.next().text("密码为6-16位");return}if(!$.max_length(e,16)||!$.min_length(e,6)||!$.isValidPassword(e)){b.next().text("密码为6-16位");return}if(f!=e){b.next().text("两次输入的新密码不一致");return}$.post("/userinfo/updatePurchase","old_pass="+md5(c)+"&new_pass="+md5(f)+"&csrf_token="+token,function(g){var g=$.jsonDecode(g);switch(g.error){case 0:closeDialog("note");break;case 2:$(a).next().text("旧密码错误");break;case 1:$(b).next().text("登录信息过期");break;case 3:$(b).next().text("网络错误");break}})}else{if(!$.max_length(f,16)||!$.min_length(f,6)||!$.isValidPassword(f)){d.next().text("密码为6-16位");return}if(!$.max_length(e,16)||!$.min_length(e,6)||!$.isValidPassword(e)){b.next().text("密码为6-16位");return}if(f!=e){b.next().text("两次输入的新密码不一致");return}$.post("/userinfo/setPurchase","new_pass="+md5(f)+"&csrf_token="+token,function(g){var g=$.jsonDecode(g);switch(g.error){case 0:is_set_purchase=1;$("tr[rel='old_purchase_tr']").css("display","table-row");$("#show_purcharse").html("*******");$("#show_purcharse").next().html("修改");closeDialog("note");break;case 2:$(a).next().text("旧密码错误");break;case 1:$(b).next().text("登录信息过期");break;case 3:$(b).next().text("网络错误");break}})}}function showDetail(a){if(a){$.post("/userinfo/showProductDetail","orderid="+a+"&csrf_token="+token,function(c){if(!$.jsonDecode(c)){return}var b=$.jsonDecode(c);$("#detail_order_id").html(b.id);$("#detail_create").html(b.create_at);$("#detail_product_name").html(b.name);$("#detail_status").html(b.status);if(b.handler_type==4||(b.handler_type==3&&b.price_type=="金币")){$("#detail_cost_name").html("抽奖"+b.price_type+"：+")}else{$("#detail_cost_name").html("消耗"+b.price_type+"：-")}$("#detail_cost").html(b.price);_showDialog("order_dialog")})}};