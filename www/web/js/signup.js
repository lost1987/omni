var nickname_valid=false,loginname_valid=false,password_valid=false,repassword_valid=false,email_valid=false,sel=-1;var KEY_UP=38,KEY_DOWN=40,KEY_ENTER=13;$(function(){$(".error").hide();$(".exsit").hide();$("#rdname").click(function(){$.post("/user/getRandomName","csrf_token="+token,function(b){var b=$.jsonDecode(b);$("#nickname").val(b.name);$("#nickname").trigger("blur")})});var a=$("#autoShow").find("td");a.hover(function(){a.css("backgroundColor","");$(this).css("backgroundColor","#912423");sel=$(this).attr("rel")},function(){$(this).css("backgroundColor","");sel=-1});a.click(function(){$("#email").val($(this).text());$("#email").blur();sel=-1});$("#login_name").blur(function(){var b=$(this);var c=b.val();if($.max_length(c,16)&&$.min_length(c,4)&&$.isValidAccount(c)){$.post("/user/checkLoginName","login_name="+c+"&csrf_token="+token,function(d){var d=$.jsonDecode(d);if(d.exsit){b.parent().find("label").hide();b.parent().find("label.exsit").show();loginname_valid=false;highLight(this,true);return}});b.parent().find("label").hide();b.parent().find("label.valid").show();loginname_valid=true;highLight(this,false)}else{b.parent().find("label").hide();b.parent().find("label.error").show();loginname_valid=false;highLight(this,true)}});$("#nickname").blur(function(){var c=$(this);var b=c.val();if($.max_length(b,8)&&$.min_length(b,3)&&$.isValidAccountAllowZh(b)){$.post("/user/checkNickName","nickname="+b+"&csrf_token="+token,function(d){var d=$.jsonDecode(d);if(d.exsit){c.parent().find("label").hide();c.parent().find("label.exsit").show();nickname_valid=false;highLight(this,true);return}});c.parent().find("label").hide();c.parent().find("label.valid").show();highLight(this,false);nickname_valid=true}else{c.parent().find("label").hide();c.parent().find("label.error").show();nickname_valid=false;highLight(this,true)}});$("#password").blur(function(){var c=$(this);var b=c.val();if($.max_length(b,16)&&$.min_length(b,6)&&$.isValidPassword(b)){c.parent().find("label").hide();c.parent().find("label.valid").show();password_valid=true;highLight(this,false)}else{c.parent().find("label").hide();c.parent().find("label.error").show();password_valid=false;highLight(this,true)}});$("#re_password").blur(function(){var c=$(this);var b=c.val();if($.max_length(b,16)&&$.min_length(b,6)&&$.isValidPassword(b)&&$("#password").val()==b){c.parent().find("label").hide();c.parent().find("label.valid").show();repassword_valid=true;highLight(this,false)}else{c.parent().find("label").hide();c.parent().find("label.error").show();repassword_valid=false;highLight(this,true)}});$("#email").blur(function(){var c=$(this);var b=c.val();if($.is_email(b)){$.post("/user/checkEmail","email="+b+"&csrf_token="+token,function(d){var d=$.jsonDecode(d);if(d.exsit){c.parent().find("label").hide();c.parent().find("label.exsit").show();email_valid=false;highLight(this,true);return}});c.parent().find("label").hide();c.parent().find("label.valid").show();email_valid=true;highLight(this,false);$("#autoShow").hide()}else{c.parent().find("label").hide();c.parent().find("label.error").show();email_valid=false;highLight(this,true)}});$("#email").keyup(function(b){var f=$(this);var c=f.form_validate_trimVal().replace(/(.*)?@(.*)\.com/g,"$1");if(c==""){$("#autoShow").hide();return}$("#autoShow").css("position","absolute").css("left",0).css("top",30).css("z-index",100).show();var d=$("#autoShow").find("td");d.each(function(e){c=c.replace(/([^@]*)?@(.*)/g,"$1");switch(e){case 0:$(this).text(c+"@qq.com");break;case 1:$(this).text(c+"@163.com");break;case 2:$(this).text(c+"@sina.com");break;case 3:$(this).text(c+"@126.com");break}});if($("#email").focus()){var g=b||window.event;if(g.keyCode==KEY_DOWN){if(sel<3){sel++;d.css("backgroundColor","");d.eq(sel).trigger("mouseover")}}else{if(g.keyCode==KEY_UP){if(sel>0){sel--;d.css("backgroundColor","");d.eq(sel).trigger("mouseover")}}}if(g.keyCode==KEY_ENTER){$("#email").val(d.eq(sel).text());$("#email").blur();d.css("backgroundColor","");sel=-1}}})});function doSubmit(){if(nickname_valid&&loginname_valid&&password_valid&&repassword_valid&&email_valid){$("#password").val(md5($("#password").val()));$("#register_form").submit()}else{$(".input").trigger("blur")}}function highLight(a,b){if(b){$(a).css("border","2px solid red");if($(a).attr("name")=="nickname"){$(a).next().css("margin","2px 0 0 -42px")}}else{$(a).css("border","1px solid #fd3234");if($(a).attr("name")=="nickname"){$(a).next().css("margin","1px 0 0 -42px")}}};