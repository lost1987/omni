var cur_product_id,cur_product_name,cur_price_name,cur_price_type_name;function _showDialog(a){$("#"+a).find("input.djsc_input_1").val("");$("#"+a).find("label").hide().html("");showDialog(a,true)}function exchange(product_id,title,category_id,price_type_name,price_name,price_column){if(!is_login){$("#tip_content").html('对不起，您尚未<a href="/">登录</a>. 请进入登录页面');_showDialog("error_tip");return}if(!is_set_purchase){$("#tip_content").html('对不起，您尚未设置消费密码. 请进入<a href="/userinfo">个人中心</a>设置');_showDialog("error_tip");return}var price=price_name.replace(/(\d+)(.*)/g,"$1");if(eval(price_column)<price){$("#tip_content").html("对不起，您的"+price_type_name+"不足");_showDialog("error_tip");return}cur_product_name=title;cur_product_id=product_id;cur_price_type_name=price_type_name;$("#dialog_"+category_id).find("h3").html("您正在兑换"+cur_product_name);$("#dialog_"+category_id).find("p").html("您正在兑换"+cur_product_name+'，该操作将消耗<span class="red bold">'+price_name+"</span>。为了保证能正确为您充值，请您仔细填写以下信息。");_showDialog("dialog_"+category_id)}function do_exchange(){var b=$("#dialog_password");var a=b.val();var c=$("#dialog_1_tip");if($.max_length(a,16)&&$.min_length(a,6)&&$.isValidPassword(a)){a=md5(a);$.post("/store/purchase/"+cur_product_id,"password="+a+"&csrf_token="+token,function(e){var d=$.jsonDecode(e);switch(d.error){case 0:closeDialog("djsc_tck");$("#success_1").find("h3").html("您已成功兑换"+cur_product_name);$("#success_1").find("p").html("已成功兑换 "+cur_product_name+'，请 <a href="#">进入游戏</a> 查看');_showDialog("success_1");break;case 1:c.html("登录信息已过期,请重新登录").show();break;case 2:c.html("消费密码错误").show();break;case 3:c.html("数据更新错误,请重试").show();break;case 4:c.html(cur_price_type_name+"不足").show();break;case 5:node_password.next().html("数据填写错误").show();break}})}else{c.html("密码不符合要求").show()}}function do_exchange_ticket(){var b=$("#dialog_5_password");var a=b.val();var c=$("#dialog_5_tip");if($.max_length(a,16)&&$.min_length(a,6)&&$.isValidPassword(a)){a=md5(a);$.post("/store/purchase/"+cur_product_id,"password="+a+"&csrf_token="+token,function(e){var d=$.jsonDecode(e);switch(d.error){case 0:closeDialog("djsc_tck");$("#success_1").find("h3").html("您已成功兑换"+cur_product_name);$("#success_1").find("p").html("已成功兑换 "+cur_product_name+'，请 <a href="#">进入游戏</a> 查看');_showDialog("success_1");break;case 1:c.html("登录信息已过期,请重新登录").show();break;case 2:c.html("消费密码错误").show();break;case 3:c.html("数据更新错误,请重试").show();break;case 4:c.html(cur_price_type_name+"不足").show();break;case 5:node_password.next().html("数据填写错误").show();break}})}else{c.html("密码不符合要求").show()}}function do_exchange_product(){var f=$("#product_name");var e=$("#product_mobile");var i=$("#product_address");var d=$("#product_password");var c=$("#product_mobile_confirm");if(f.form_validate_trimVal()==""){f.next().html("请填写姓名").show();return}else{f.next().html("").hide()}if(!$.is_mobile(e.form_validate_trimVal())){e.next().html("请填写正确的手机号码").show();return}else{e.next().html("").hide()}if(!$.is_mobile(c.val())||c.form_validate_trimVal()!=e.form_validate_trimVal()){c.next().html("两次填写的手机号不一致").show();return}else{c.next().html("").hide()}if(i.form_validate_trimVal()==""){i.next().html("地址不能为空").show();return}else{i.next().html("").hide()}var h=d.val();var a=f.form_validate_trimVal();var b=e.form_validate_trimVal();var g=i.val();if($.max_length(h,16)&&$.min_length(h,6)&&$.isValidPassword(h)){h=md5(h);$.post("/store/purchase/"+cur_product_id+"/"+a+"/"+b+"/","password="+h+"&address="+g+"&csrf_token="+token,function(k){var j=$.jsonDecode(k);switch(j.error){case 0:closeDialog("djsc_tck");$("#success_1").find("h3").html("您的兑换信息已提交");$("#success_1").find("p").html("请等待工作人员处理");_showDialog("success_1");break;case 1:d.next().html("登录信息已过期,请重新登录").show();break;case 2:d.next().html("消费密码错误").show();break;case 3:d.next().html("数据更新错误,请重试").show();break;case 4:d.next().html(cur_price_type_name+"不足").show();break;case 5:d.next().html("数据填写错误").show();break}})}else{d.next().html("密码不符合要求").show()}}function do_exchange_mobile(){var c=$("#mobile_name");var g=$("#mobile_number");var b=$("#confirm_number");var a=$("#mobile_pwd");if(c.form_validate_trimVal()==""){c.next().html("请填写姓名").show();return}else{c.next().html("").hide()}if(!$.is_mobile(g.form_validate_trimVal())){g.next().html("请填写正确的手机号码").show();return}else{g.next().html("").hide()}if(!$.is_mobile(b.val())||b.form_validate_trimVal()!=g.form_validate_trimVal()){b.next().html("两次填写的手机号不一致").show();return}else{b.next().html("").hide()}var f=a.val();var e=c.form_validate_trimVal();var d=g.form_validate_trimVal();if($.max_length(f,16)&&$.min_length(f,6)&&$.isValidPassword(f)){f=md5(f);$.post("/store/purchase/"+cur_product_id+"/"+e+"/"+d+"/","password="+f+"&csrf_token="+token,function(i){var h=$.jsonDecode(i);switch(h.error){case 0:closeDialog("djsc_tck");$("#success_1").find("h3").html("您的兑换信息已提交");$("#success_1").find("p").html("请等待工作人员处理");_showDialog("success_1");break;case 1:a.next().html("登录信息已过期,请重新登录").show();break;case 2:a.next().html("消费密码错误").show();break;case 3:a.next().html("数据更新错误,请重试").show();break;case 4:a.next().html(cur_price_type_name+"不足").show();break}})}else{a.next().html("密码不符合要求").show()}};