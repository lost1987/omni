var response,current_prize,play_interval,current,jp_count=8,jp_divs,max_count,count=0,speed=100;$(function(){if(lottery_times==0){$("#lottery_btn").addClass("lock")}if(is_login){$("#lottery_btn").click(send_lottery)}getNewLottery();setInterval("getNewLottery()",50000);jp_divs=$(".jp_list div")});function getNewLottery(){$.post("/user/newlottery","csrf_token="+token,function(b){b=$.jsonDecode(b);var a="";$.each(b.data,function(c){a+="<li>"+b.data[c].login_name+"刚刚抽中了 "+b.data[c].product_name+"</li>"});$(".btmbox").find("ul").html(a)})}function move(){var b=current+1;if(b>jp_count){b=1}$(".jp_"+current).removeClass("on");$(".jp_"+b).addClass("on");current=b;count++;if(count==max_count){clearInterval(play_interval);count=0;if(response.data.type=="normal"){showDialog("get_lottery",true);$("#get_lottery .jp").html(response.data.name);if(response.data.level==7||response.data.level==8){var a=parseInt($(".ljcz").prev().text());a+=response.data.price;$(".ljcz").prev().html(a)}else{if(response.data.level==5||response.data.level==6){var c=parseInt($("#my_diamond").text());c+=response.data.price;$("#my_diamond").html(c)}}}else{if(response.data.type=="need_mobile"){showDialog("get_real",true);$("#get_real .jp").html(response.data.name);$("#fill_address").hide()}else{if(response.data.type=="need_address"){showDialog("get_real",true);$("#get_real .jp").html(response.data.name);$("#fill_address").show()}}}}}function animation(){$(".jp_"+current).removeClass("on");current=1;var a=response.data.index;max_count=jp_count*3+Math.abs(current-a);play_interval=setInterval("move()",speed)}function send_lottery(){$("#fill_btn").attr("disabled",false);$("#tishi").hide();if(lottery_times>0){$("#lottery_btn").addClass("lock").unbind("click");$.post("/lottery","csrf_token="+token,function(a){response=$.jsonDecode(a);current_prize=response.data.name;switch(response.error){case 0:lottery_times--;$(".sycs").html("剩余"+lottery_times+"次");animation();break;case 1:alert("请登录");break;case 7:alert("非法请求");break;case 17:alert("次数不足");break;case 3:alert("未知错误");break}$("#lottery_btn").click(send_lottery);if(lottery_times==0){$("#lottery_btn").addClass("lock")}else{$("#lottery_btn").removeClass("lock")}})}else{$("#lottery_btn").addClass("lock");$(".sycs").html("剩余0次");if(login){showDialog("get_nothing",true)}else{}}}function sendinfo(){var b=$("#_name");var e=$("#_mobile");var f=$("#_address");var d=b.form_validate_trimVal();var c=e.form_validate_trimVal();var a=f.val();if(!$.max_length(d,20)||!$.min_length(d,2)){$("#tip_name").show();return}else{$("#tip_name").hide()}if(!$.is_mobile(c)){$("#tip_mobile").show();return}else{$("#tip_mobile").hide()}if(response.data.type=="need_address"){if(a==""){$("#tip_address").show();return}else{$("#tip_address").hide()}}$.post("/lottery/fillinfo","csrf_token="+token+"&name="+d+"&mobile="+c+"&address="+a+"&order_id="+response.data.order_id,function(g){g=$.jsonDecode(g);if(g.error==0){$("#tishi").show();$("#fill_btn").attr("disabled",true)}})}function wb_shared(){window.location.href="/weibo/sina/shared/"+current_prize};